<head>
<!-- ... -->

{% load django_simple_bulma %}
{% bulma %}
{% load static %}
    <title>ПИК</title>
<link rel="shortcut icon" type="image/png" href="{% static 'icons/letter-k.png' %}"/>
<link rel="stylesheet" href="{% static 'css/font_awesome/all.css' %}">
<link rel="stylesheet" href="{% static 'css/base_styles.css' %}">

    {% block extra_css %}
    {% endblock %}
</head>



<body oncontextmenu="return false;" onselectstart="return false;">
    <div class="flex-wrapper">
        <nav class="navbar is-black" role="navigation" aria-label="main navigation">
          <div class="navbar-brand">
              <figure class="image is-64x64">
                  <img src="{% static 'icons/vuz_logo.png' %}" />
              </figure>
            <a class="navbar-item pl-1 pr-1 no-hover">
              <h1><strong>ПИК «КИБЕРПОЛИГОН»</strong></h1>
            </a>

          </div>
            <div class="navbar-start">
              {% if  user.is_superuser %}
                  <a class="navbar-item" href="{% url 'interface:lab-menu' %}">
                      Лабораторные работы
                  </a>
              {% endif %}

              {% if user.is_authenticated %}
                <a class="navbar-item" href="{% url 'interface:competition-list' %}">
                  Экзамены
                </a>
                  <a class="navbar-item" href="{% url 'interface:team-competition-list' %}">
                  Соревнования
                </a>
                <a class="navbar-item" href="{% url 'interface:competition-history-list' %}">
                  История
                </a>
              {% endif %}

              {% if user.is_superuser %}
                <a class="navbar-item" href = "{% url 'interface:platoon-list' %}">
                  Список взводов
                </a>
              {% endif %}
            </div>

            <div class="navbar-end">
                {% if pnet_username %}
                    <div class="navbar-item no-hover">
                        <h4 id="allow-copy"  class="title is-6 has-text-white">Ваше имя в PNET: {{ pnet_username }}</h4>
                    </div>
                {% endif %}
              <div class="navbar-item no-hover">
                <div class="buttons">
                    {% if user.is_authenticated %}
                        {% if user.is_superuser %}
                            <a class="button is-light" href="{% url 'admin:index' %}">
                                <strong>Админ-панель</strong>
                            </a>
                        {% else %}
                          <a class="button is-light" href="{% url 'change_password' %}">
                            <strong>Сменить пароль</strong>
                          </a>
                        {% endif %}
                        <form class="m-0" method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button class="button is-light" type="submit"><strong>Выйти</strong></button>
                        </form>
                    {% else %}
                      <a class="button is-primary" href="{% url 'reg' %}">
                        <strong>Войти как участник</strong>
                      </a>
                      <a class="button is-light" href="{% url 'login' %}">
                        <strong>Войти как администратор</strong>
                      </a>
                    {% endif %}
                </div>
              </div>
            </div>
        </nav>

        {% block background_video %}
        <!-- Optional: Block to add a background video in derived templates -->
        {% endblock %}
        {% block title_image %}
            <!-- Optional: Block to add an image with text on it -->
        {% endblock %}

        <section class="hero is-flex-grow-1">
            <div class="hero-body is-flex-grow-1 is-flex is-align-items-center">
                <div class="container is-flex-grow-1 {% block container_class %}{% endblock %}">
                    {% block content %}
                    {% endblock %}
                </div>
            </div>
        </section>

        <footer class="footer {% block footer_class %} {% endblock %} mt-auto">
          <div class="content has-text-centered">
            <p>
              Разработано в <strong>ВУЦ НИУ ВШЭ</strong>
            </p>
          </div>
        </footer>

    </div>
    
    <!-- jQuery для анимаций -->
    <script src="{% static 'admin/js/jquery-3.7.1.min.js' %}"></script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var allowCopyElement = document.getElementById('allow-copy');
        allowCopyElement.oncontextmenu = function(event) {
            event.stopPropagation();
        };
        allowCopyElement.onselectstart = function(event) {
            event.stopPropagation();
        };
        
        // Определение текущей страницы и подсветка активного элемента
        function highlightCurrentPage() {
            const currentPath = window.location.pathname;
            const urlParams = new URLSearchParams(window.location.search);
            const utmSource = urlParams.get('utm_source');
            const navbarItems = document.querySelectorAll('.navbar-item');
            
            // Маппинг текста ссылки к путям и utm_source
            const pageMapping = {
                'экзамен': {
                    paths: ["{% url 'interface:competition-list' %}"],
                    utm_sources: ['competitions']
                },
                'соревнован': {
                    paths: ["{% url 'interface:team-competition-list' %}"],
                    utm_sources: ['team_competitions']
                },
                'истори': {
                    paths: ["{% url 'interface:competition-history-list' %}"],
                    utm_sources: ['history']
                },
                'лабораторн': {
                    paths: ["{% url 'interface:lab-menu' %}", "{% url 'interface:lab-list' %}"],
                    utm_sources: ['labs', 'lab-menu']
                },
                'взвод': {
                    paths: ["{% url 'interface:platoon-list' %}"],
                    utm_sources: ['platoons']
                },
                'войти': {
                    paths: ["{% url 'reg' %}", "{% url 'login' %}"],
                    utm_sources: ['reg', 'login']
                }
            };
            
            navbarItems.forEach(item => {
                const linkText = item.textContent.trim().toLowerCase();
                
                // Проверяем каждый тип страницы
                for (const [key, mapping] of Object.entries(pageMapping)) {
                    if (linkText.includes(key)) {
                        let isActive = false;
                        
                        // Если есть utm_source - проверяем только его
                        if (utmSource) {
                            isActive = mapping.utm_sources.includes(utmSource);
                        } else {
                            // Fallback на проверку пути только если нет utm_source
                            isActive = mapping.paths.some(path => currentPath.includes(path));
                        }
                        
                        if (isActive) {
                            item.classList.add('active');
                            break;
                        }
                    }
                }
            });
        }
        
        // Запуск функции подсветки
        highlightCurrentPage();
        
        // Дополнительная анимация при наведении
        $('.navbar-item').hover(
            function() {
                $(this).addClass('hover-effect');
            },
            function() {
                $(this).removeClass('hover-effect');
            }
        );
    });
</script>
</body>