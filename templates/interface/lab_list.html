{% extends 'interface/base.html' %}
{% load static %}
{% load utm_filters %}

{% block content %}
    <div class="block">
        <div class="has-text-centered mb-5">
            <h1 class="title is-2 has-text-centered">
                <span class="has-background-grey-lighter has-text px-3 py-2" style="border-radius: 12px;">Лабораторные работы</span>
                {% if object_list and object_list.0 %}
                    <!-- TODO: сильно отвлекает взор. Возможно, сделать светло-серым, а "лабораторные работы" на белом фоне -->
                    <span class="has-background-grey-dark has-text-white px-3 py-2" style="border-radius: 12px;">{{ object_list.0.get_program_display }}</span> 
                {% endif %}
            </h1>
        </div>

        <!-- Сетка карточек -->
        <div class="columns is-multiline">
            {% for lab_bundle in lab_bundles %}
                    <div class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div class="card lab-card">
                            <div class="card-image">
                                <figure class="image">
                                    {% if lab_bundle.cover %}
                                        <img src="{{ lab_bundle.cover.url }}"
                                            alt="{{ lab_bundle.name }}"
                                            class="lab-icon" style="height:15vh !important; width:100%; object-fit: cover; opacity:0.9;">
                                    {% else %}
                                        <img src="{% static 'images/computers.jpg' %}"
                                            alt="{{ lab_bundle.name }}"
                                            class="lab-icon" style="height:15vh !important; width:100%; object-fit: cover; opacity:0.7;">
                                    {% endif %}
                                </figure>
                            </div>

                            <div class="card-content">
                                <h3 class="title is-4 has-text-centered mb-3">{{ lab_bundle.name }}</h3>

                                <!-- <div class="content has-text-centered">
                                    <p class="lab-description">{{ lab.description|clean_html_images|truncatewords:15 }}</p>
                                </div> -->

                                <!-- TODO: для соревнований не показывать кнопку и анимировать всю карточку ?? - пока не уверен -->

                                <div class="buttons is-centered mt-4">
                                    {% for type, lab in lab_bundle.labs.items %}
                                        {% if lab %}
                                            <a href="{% url 'interface:lab-detail' lab.slug lab.lab_type %}"
                                            class="button {{ lab.lab_type|lab_type_class }} is-small is-rounded action-button">
                                            <span class="icon is-small"><i class="fas fa-flask"></i></span>
                                                <span>{{ lab.get_lab_type_display }}</span>
                                            </a>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
            {% empty %}
                <div class="column is-12">
                    <div class="notification is-info has-text-centered">
                        Лабораторных работ нет.
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Стили -->
    <style>
        .lab-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
            height: 100%;
            display: flex; 
            flex-direction: column;
        }
        .lab-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        }

        .lab-icon {
            height: 10vh;
            width: 100%;
            object-fit: cover;
            opacity: 0.8;
        }

        .lab-description {
            color: #b5b5b5;
            font-size: 0.9rem;
        }

        .action-button {
            transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
        }
        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .action-button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 6px rgba(0,0,0,0.18);
            filter: brightness(0.96);
        }

        /* Подсказка пользователю */
        .lab-card .card-content::after {
            content: '☝ Нажмите на кнопку для перехода';
            display: block;
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .lab-card:hover .card-content::after {
            opacity: 1;
        }
    </style>
{% endblock %}